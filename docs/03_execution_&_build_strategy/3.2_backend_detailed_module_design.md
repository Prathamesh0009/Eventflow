# Phase 3.2 – Backend Detailed Module Design

> **Goal of this phase**
>
> This phase defines *exact backend modules*, their responsibilities, internal workflows, and interactions **before any code is written**. By the end of this phase:
>
> * Every backend component has a clear purpose
> * No overlapping responsibilities
> * Easy mapping from design → code
> * Interviewers can clearly see system-thinking depth

---

## 1. Backend Design Philosophy

EventFlow backend follows these principles:

* **Event-first architecture** (events are first-class citizens)
* **Separation of concerns** (API, domain, persistence, infra)
* **Stateless services** (state lives in DB / queues)
* **Horizontal scalability by default**
* **Failure is expected and designed for**

---

## 2. Core Backend Modules (High-Level)

```
backend/
├── api/            # HTTP layer (controllers)
├── auth/           # Authentication & authorization
├── events/         # Event ingestion & validation
├── consumers/      # Consumer groups & offset handling
├── processing/     # Event processing pipelines
├── storage/        # Database access layer
├── retry_dlq/      # Retry & dead-letter handling
├── observability/  # Logs, metrics, tracing
└── config/         # Environment & feature flags
```

Each module is explained in depth below.

---

## 3. Authentication & Authorization Module (`auth/`)

### Purpose

Controls **who can send events** and **who can consume events**.

### Responsibilities

* User registration & login
* API key generation for producers
* JWT-based auth for dashboard users
* Role-based access control (RBAC)

### Roles

* **Admin** → manage org, users, pipelines
* **Producer** → publish events
* **Consumer** → read events

### Key Decisions

* API Producers use **API Keys**
* Dashboard users use **JWT (access + refresh)**

---

## 4. Event Ingestion Module (`events/`)

### Purpose

Accepts incoming events from producers and validates them.

### Responsibilities

* Schema validation
* Metadata enrichment (timestamp, event_id)
* Persistence of raw events
* Forwarding to processing pipeline

### Event Lifecycle

1. Event received via REST API
2. Validate payload & schema
3. Assign unique event_id
4. Store raw event
5. Publish internally for processing

### Why this matters

* Enables **event replay**
* Enables **audit logs**
* Enables **debugging production issues**

---

## 5. Processing Module (`processing/`)

### Purpose

Handles **what happens after an event is ingested**.

### Responsibilities

* Apply transformation rules
* Route events to topics/streams
* Trigger async workflows

### Processing Types

* **Pass-through** (store & forward)
* **Transform** (modify payload)
* **Filter** (drop events)

### Design Choice

Processing is **asynchronous** to avoid blocking producers.

---

## 6. Consumer Management Module (`consumers/`)

### Purpose

Manages how consumers read events.

### Responsibilities

* Consumer group registration
* Offset tracking per group
* Event delivery guarantees

### Delivery Model

* At-least-once delivery
* Offset stored in database

### Why offsets matter

* Enables replay
* Enables fault tolerance
* Mimics real streaming systems (Kafka-style)

---

## 7. Storage Layer (`storage/`)

### Purpose

Abstracts all database operations.

### Responsibilities

* CRUD for events
* Offset persistence
* User & API key storage

### Design Rules

* No raw SQL outside this module
* All queries optimized for reads

---

## 8. Retry & Dead Letter Module (`retry_dlq/`)

### Purpose

Handles failures gracefully.

### Responsibilities

* Retry failed event processing
* Move poison events to DLQ
* Allow manual reprocessing

### Retry Strategy

* Exponential backoff
* Max retry count

### DLQ Benefits

* No silent data loss
* Production-grade reliability

---

## 9. Observability Module (`observability/`)

### Purpose

Provides visibility into system health.

### Responsibilities

* Structured logging
* Metrics collection
* Error tracking

### Metrics Examples

* Events ingested/sec
* Failed events count
* Consumer lag

---

## 10. Configuration Module (`config/`)

### Purpose

Centralized configuration management.

### Responsibilities

* Environment variables
* Feature flags
* Rate limits