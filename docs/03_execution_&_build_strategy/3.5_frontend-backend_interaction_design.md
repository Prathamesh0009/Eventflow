# Phase 3.5 – Frontend ↔ Backend Interaction Design

> **Goal of this phase**
>
> Define **exact interactions between the Next.js frontend and EventFlow backend** before coding.
> This ensures predictable integration and smooth developer experience.

---

## 1. Frontend Scope (MVP)

* Dashboard for producers & admins
* Event creation (manual or simulation)
* Consumer monitoring & event consumption
* Authentication & role-based access
* Basic analytics display (counts, recent events)

---

## 2. High-Level Interaction Flow

```
Next.js Frontend
 └──> REST API / GraphQL (NestJS backend)
       ├── Auth Module (login, API keys)
       ├── Event Module (ingest, validate)
       ├── Consumer Module (read events, commit offsets)
       └── Observability Module (metrics & logs)
```

---

## 3. API Usage Mapping

| Frontend Feature      | Backend Endpoint                  | Method | Payload / Params               | Response                   |
| --------------------- | --------------------------------- | ------ | ------------------------------ | -------------------------- |
| Login                 | /api/v1/auth/login                | POST   | email, password                | JWT access + refresh       |
| Producer create event | /api/v1/events                    | POST   | JSON payload, API key          | 202 Accepted               |
| Consumer fetch events | /api/v1/streams/{streamId}/events | GET    | consumer_group_id, last_offset | Array of events            |
| Producer dashboard    | /api/v1/producers                 | GET    | Auth token                     | List of API keys, streams  |
| Analytics counts      | /api/v1/streams/{streamId}/stats  | GET    | streamId                       | Event counts, consumer lag |

---

## 4. Authentication & Session Flow

* Users login → receive JWT (short-lived access + long-lived refresh)
* API keys for producers stored securely in frontend env or session
* Frontend attaches JWT / API key in all requests
* Guards ensure proper role access (admin / producer / consumer)

---

## 5. State Management Strategy

* **React Query / SWR** for data fetching & caching
* **Zustand / Redux** for global state (auth, selected streams)
* **Client-side caching** for recent events & counts
* **Optimistic UI** for event submissions

---

## 6. Error & Loading Handling

* Centralized error boundary for React components
* Toast notifications for success/failure
* Loading skeletons during API calls
* Retry logic for transient failures (network issues)

---

## 7. Event Flow Summary (Frontend POV)

1. User submits event → frontend validates → calls backend POST `/events`
2. Backend responds 202 → frontend shows success message
3. Consumer polls backend for events → updates list in dashboard
4. Offsets committed → frontend reflects latest status
5. Errors shown clearly (DLQ alert if needed)

---

## 8. Component ↔ Module Mapping

| Frontend Component | Backend Module                |
| ------------------ | ----------------------------- |
| LoginForm          | Auth Module                   |
| EventForm          | Events Module                 |
| ConsumerList       | Consumer Module               |
| StreamStats        | Events / Observability Module |
| APIKeyManager      | Auth / Producers Module       |