# Phase 3.1 – Backend Execution Design

## 1. Purpose

This document defines **how the backend of EventFlow will be implemented**, step by step, **without writing code yet**.

The goal is to:

* Translate architecture into executable steps
* Reduce ambiguity during implementation
* Ensure backend development is predictable and incremental

---

## 2. Backend Scope (MVP)

The backend is responsible for:

* Authentication & authorization
* Event ingestion
* Event storage
* Event dispatching
* Internal consumer handling
* Observability & logging

---

## 3. Backend Project Structure (Planned)

```text
backend/
├── src/
│   ├── app.module.ts
│   ├── main.ts
│   │
│   ├── modules/
│   │   ├── auth/
│   │   ├── producers/
│   │   ├── events/
│   │   ├── consumers/
│   │   └── health/
│   │
│   ├── common/
│   │   ├── guards/
│   │   ├── filters/
│   │   ├── interceptors/
│   │   └── utils/
│   │
│   └── infrastructure/
│       ├── database/
│       ├── redis/
│       └── logging/
│
├── test/
└── Dockerfile
```

---

## 4. Execution Order (Very Important)

Backend will be built in the following order:

### Step 1 – Project Bootstrap

* Initialize NestJS project
* Configure TypeScript
* Add linting & formatting

### Step 2 – Infrastructure Layer

* PostgreSQL connection
* Redis connection
* Environment configuration

### Step 3 – Authentication Module

* JWT-based auth
* API key validation for producers

### Step 4 – Producer Management

* Producer registration
* API key generation

### Step 5 – Event Ingestion

* Event validation
* Metadata enrichment
* Event persistence

### Step 6 – Event Dispatching

* Dispatch logic
* Retry handling
* Offset tracking

### Step 7 – Consumer Handling

* Consumer registration
* Event polling

### Step 8 – Observability

* Logging
* Error handling
* Metrics hooks

---

## 5. Module Responsibilities

### 5.1 Auth Module

* Login
* Token issuance
* Guard enforcement

### 5.2 Producers Module

* Register producers
* Manage API keys

### 5.3 Events Module

* Ingest events
* Store events
* Query events

### 5.4 Consumers Module

* Register consumers
* Track offsets

---

## 6. Data Access Strategy

* Prisma Client for database access
* Service layer wraps Prisma operations
* No raw queries in controllers
* Transaction boundaries explicit (Prisma transactions)

---

## 7. Error Handling Strategy

* Global exception filters
* Structured error responses
* Correlation IDs in logs

---

## 8. Testing Strategy (Backend)

* Unit tests for services
* Integration tests for APIs
* No end-to-end tests in MVP

---

## 9. Done Criteria (Backend MVP)

Backend is considered complete when:

* Events can be ingested
* Events are stored immutably
* Consumers can retrieve events
* Errors are observable