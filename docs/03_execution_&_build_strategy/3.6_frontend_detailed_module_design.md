# Phase 3.6 – Frontend Detailed Module Design

> **Goal of this phase**
>
> Define **exact frontend architecture, components, and state management** for the EventFlow Next.js dashboard before implementation begins.

---

## 1. Frontend Architecture Overview

### 1.1 Technology Stack

* **Framework:** Next.js 14+ (App Router)
* **Language:** TypeScript
* **UI Library:** React 18+
* **Styling:** Tailwind CSS
* **State Management:** Zustand (global) + React Query (server state)
* **Forms:** React Hook Form + Zod validation
* **HTTP Client:** Axios
* **Authentication:** NextAuth.js (or custom JWT handling)

---

## 2. Project Structure

```
frontend/
├── app/                    # Next.js App Router
│   ├── (auth)/            # Auth routes group
│   │   ├── login/
│   │   └── layout.tsx
│   ├── (dashboard)/       # Protected routes
│   │   ├── streams/
│   │   ├── events/
│   │   ├── consumers/
│   │   └── settings/
│   ├── api/               # API routes (if needed)
│   ├── layout.tsx         # Root layout
│   └── page.tsx           # Home/redirect
│
├── components/            # Reusable components
│   ├── ui/               # Base UI components
│   │   ├── Button.tsx
│   │   ├── Input.tsx
│   │   ├── Table.tsx
│   │   └── Modal.tsx
│   ├── layout/           # Layout components
│   │   ├── Header.tsx
│   │   ├── Sidebar.tsx
│   │   └── Layout.tsx
│   ├── features/         # Feature-specific components
│   │   ├── events/
│   │   ├── streams/
│   │   └── consumers/
│   └── auth/             # Auth components
│
├── lib/                  # Utilities & configs
│   ├── api/             # API client
│   │   ├── client.ts
│   │   └── endpoints.ts
│   ├── hooks/           # Custom hooks
│   ├── utils/           # Helper functions
│   └── stores/          # Zustand stores
│
├── types/               # TypeScript types
│   ├── api.ts
│   ├── events.ts
│   └── streams.ts
│
└── styles/              # Global styles
    └── globals.css
```

---

## 3. Core Modules

### 3.1 Authentication Module

**Components:**
* `LoginForm` - Email/password login
* `AuthGuard` - Route protection wrapper
* `AuthProvider` - Context for auth state

**State Management:**
* Zustand store: `useAuthStore`
  * `user` - Current user data
  * `token` - JWT access token
  * `isAuthenticated` - Boolean
  * `login()` - Login function
  * `logout()` - Logout function
  * `refreshToken()` - Token refresh

**Flow:**
1. User submits login form
2. API call to `/api/v1/auth/login`
3. Store tokens (access in memory, refresh in cookie)
4. Redirect to dashboard
5. Auto-refresh token before expiry

---

### 3.2 Streams Module

**Pages:**
* `/streams` - List all streams
* `/streams/new` - Create new stream
* `/streams/[id]` - Stream details & events

**Components:**
* `StreamList` - Table of streams
* `StreamForm` - Create/edit stream
* `StreamCard` - Stream summary card
* `StreamStats` - Event counts, consumer lag

**State Management:**
* React Query: `useStreams()`, `useStream(id)`
* Zustand: `useStreamStore` (selected stream)

**API Integration:**
* `GET /api/v1/streams` - List streams
* `POST /api/v1/streams` - Create stream
* `GET /api/v1/streams/{id}` - Get stream details
* `GET /api/v1/streams/{id}/stats` - Get statistics

---

### 3.3 Events Module

**Pages:**
* `/events` - Event browser (all streams)
* `/streams/[id]/events` - Events for specific stream

**Components:**
* `EventList` - Paginated event table
* `EventCard` - Event detail card
* `EventFilters` - Filter by type, date range
* `EventViewer` - JSON payload viewer
* `EventTimeline` - Time-series visualization

**State Management:**
* React Query: `useEvents(streamId, filters)`
* Infinite scroll with `useInfiniteQuery`

**Features:**
* Real-time updates (polling or WebSocket)
* JSON syntax highlighting
* Copy event ID/payload
* Export events (CSV/JSON)

---

### 3.4 Consumer Groups Module

**Pages:**
* `/consumers` - List consumer groups
* `/consumers/[id]` - Consumer group details

**Components:**
* `ConsumerGroupList` - Table of groups
* `ConsumerGroupForm` - Create group
* `OffsetTracker` - Visual offset progress
* `ConsumerLag` - Lag visualization

**State Management:**
* React Query: `useConsumerGroups()`
* Real-time polling for lag metrics

---

### 3.5 API Keys Module

**Pages:**
* `/settings/api-keys` - Manage API keys

**Components:**
* `ApiKeyList` - List of keys
* `ApiKeyForm` - Create new key
* `ApiKeyCard` - Key details (masked)
* `RevokeKeyDialog` - Confirmation modal

**Security:**
* Keys shown only once (on creation)
* Masked display: `ef_live_****...`
* Copy-to-clipboard functionality

---

## 4. State Management Strategy

### 4.1 Server State (React Query)

**Used for:**
* API data fetching
* Caching
* Background refetching
* Optimistic updates

**Example:**
```typescript
const { data, isLoading, error } = useQuery({
  queryKey: ['streams', orgId],
  queryFn: () => api.getStreams(orgId),
  staleTime: 30000, // 30 seconds
});
```

### 4.2 Global Client State (Zustand)

**Used for:**
* Authentication state
* UI preferences (theme, sidebar)
* Selected stream/event
* Notification state

**Example:**
```typescript
const useAuthStore = create((set) => ({
  user: null,
  token: null,
  login: (user, token) => set({ user, token }),
  logout: () => set({ user: null, token: null }),
}));
```

### 4.3 Local Component State (useState)

**Used for:**
* Form inputs
* Modal open/close
* UI interactions

---

## 5. API Client Architecture

### 5.1 API Client Setup

```typescript
// lib/api/client.ts
const apiClient = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Request interceptor - Add auth token
apiClient.interceptors.request.use((config) => {
  const token = useAuthStore.getState().token;
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Response interceptor - Handle errors
apiClient.interceptors.response.use(
  (response) => response,
  async (error) => {
    if (error.response?.status === 401) {
      // Refresh token or logout
    }
    return Promise.reject(error);
  }
);
```

### 5.2 Typed API Endpoints

```typescript
// lib/api/endpoints.ts
export const streamsApi = {
  list: (orgId: string) => 
    apiClient.get<Stream[]>(`/api/v1/streams`),
  
  create: (data: CreateStreamDto) =>
    apiClient.post<Stream>(`/api/v1/streams`, data),
  
  getById: (id: string) =>
    apiClient.get<Stream>(`/api/v1/streams/${id}`),
};
```

---

## 6. UI Component Library

### 6.1 Base Components

**Button:**
* Variants: primary, secondary, danger
* Sizes: sm, md, lg
* Loading state
* Disabled state

**Input:**
* Text, email, password types
* Error states
* Label + helper text

**Table:**
* Sortable columns
* Pagination
* Row selection
* Responsive

**Modal:**
* Open/close animation
* Backdrop click to close
* Escape key to close
* Focus trap

### 6.2 Feature Components

**EventViewer:**
* JSON syntax highlighting
* Expand/collapse nested objects
* Copy functionality
* Search within payload

**StreamStats:**
* Event count cards
* Consumer lag indicators
* Time-series charts (future)

---

## 7. Routing & Navigation

### 7.1 Route Structure

```
/                          → Redirect to /streams
/login                     → Login page
/streams                   → Stream list
/streams/new                → Create stream
/streams/[id]              → Stream details
/streams/[id]/events       → Stream events
/events                    → All events
/consumers                 → Consumer groups
/consumers/[id]            → Consumer details
/settings                  → Settings
/settings/api-keys         → API key management
```

### 7.2 Route Protection

```typescript
// app/(dashboard)/layout.tsx
export default function DashboardLayout({ children }) {
  const { isAuthenticated } = useAuthStore();
  
  if (!isAuthenticated) {
    redirect('/login');
  }
  
  return <Layout>{children}</Layout>;
}
```

---

## 8. Error Handling

### 8.1 Error Boundaries

```typescript
// components/ErrorBoundary.tsx
export class ErrorBoundary extends React.Component {
  // Catch React errors
  // Display fallback UI
  // Log to error tracking service
}
```

### 8.2 API Error Handling

* Global error handler in API client
* Toast notifications for errors
* Retry logic for transient failures
* Error codes mapped to user-friendly messages

---

## 9. Loading States

### 9.1 Loading Patterns

* **Skeleton screens** - For initial loads
* **Spinners** - For quick actions
* **Progress bars** - For long operations
* **Optimistic updates** - For better UX

---

## 10. Responsive Design

### 10.1 Breakpoints

* Mobile: < 640px
* Tablet: 640px - 1024px
* Desktop: > 1024px

### 10.2 Mobile Considerations

* Collapsible sidebar
* Touch-friendly buttons
* Swipe gestures (future)
* Bottom navigation (mobile)

---

## 11. Performance Optimization

### 11.1 Code Splitting

* Route-based splitting (automatic with App Router)
* Component lazy loading
* Dynamic imports for heavy components

### 11.2 Caching Strategy

* React Query cache (30s stale time)
* Static page generation where possible
* Image optimization (Next.js Image)

### 11.3 Bundle Optimization

* Tree shaking
* Minification
* Compression (gzip/brotli)

---

## 12. Testing Strategy (Frontend)

### 12.1 Unit Tests

* Component tests (React Testing Library)
* Hook tests
* Utility function tests

### 12.2 Integration Tests

* API integration tests
* Form submission flows
* Authentication flows

### 12.3 E2E Tests (Future)

* Playwright or Cypress
* Critical user journeys

---

## 13. Accessibility

### 13.1 WCAG Compliance

* Keyboard navigation
* Screen reader support
* ARIA labels
* Color contrast (WCAG AA)

### 13.2 Semantic HTML

* Proper heading hierarchy
* Form labels
* Button roles
* Landmark regions

---

## 14. Summary

The frontend architecture provides:

* ✅ Clear component structure
* ✅ Scalable state management
* ✅ Type-safe API integration
* ✅ Reusable UI components
* ✅ Route protection
* ✅ Error handling
* ✅ Performance optimization
* ✅ Accessibility support

This design ensures a **maintainable, scalable, and user-friendly** frontend implementation.
