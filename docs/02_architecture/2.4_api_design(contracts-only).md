# Phase 2.4 – API Design (Contracts Only)

## 1. Purpose

This document defines the **API contracts** for EventFlow.

The focus is on:

* Endpoint structure
* Request & response schemas
* Authentication expectations
* Error handling conventions

❗ No implementation details are included.

---

## 2. API Design Principles

* **RESTful design**
* **Versioned APIs** (`/api/v1`)
* **Stateless requests**
* **Clear separation** between admin, producer, and internal APIs
* **Explicit error responses**

---

## 3. Authentication Model

### 3.1 Auth Mechanism

* JWT-based authentication
* API Key authentication for event producers

### 3.2 Auth Types by Actor

| Actor                  | Auth Method   |
| ---------------------- | ------------- |
| Admin / Dashboard User | JWT           |
| Event Producer         | API Key       |
| Internal Consumers     | Service Token |

---

## 4. API Domains

EventFlow exposes APIs under the following domains:

* Auth APIs
* Producer Management APIs
* Event Ingestion APIs
* Event Query APIs
* Consumer APIs
* Health & System APIs

---

## 5. Auth APIs

### POST /api/v1/auth/login

**Purpose:**
Authenticate dashboard user.

**Request:**

```json
{
  "email": "string",
  "password": "string"
}
```

**Response:**

```json
{
  "access_token": "jwt",
  "refresh_token": "jwt",
  "expires_in": 3600
}
```

---

## 6. Producer Management APIs

### POST /api/v1/producers

**Purpose:**
Register a new event producer.

**Request:**

```json
{
  "name": "string",
  "description": "string"
}
```

**Response:**

```json
{
  "producer_id": "uuid",
  "api_key": "string",
  "created_at": "timestamp"
}
```

---

## 7. Event Ingestion APIs

### POST /api/v1/events

**Purpose:**
Ingest a new event into EventFlow.

**Auth:** API Key

**Request:**

```json
{
  "event_type": "string",
  "event_version": 1,
  "payload": { }
}
```

**Response:**

```json
{
  "event_id": "uuid",
  "status": "ACCEPTED",
  "received_at": "timestamp"
}
```

---

## 8. Event Query APIs

### GET /api/v1/events

**Purpose:**
Query stored events.

**Query Params:**

* event_type
* producer_id
* from
* to
* limit

**Response:**

```json
{
  "items": [ { "event_id": "uuid", "event_type": "string" } ],
  "total": 100
}
```

---

## 9. Consumer APIs

### POST /api/v1/consumers

**Purpose:**
Register internal consumer.

**Request:**

```json
{
  "name": "string",
  "subscribed_event_types": ["string"]
}
```

---

### GET /api/v1/consumers/{id}/events

**Purpose:**
Fetch next events for consumer.

**Response:**

```json
{
  "events": [ { "event_id": "uuid", "payload": {} } ]
}
```

---

## 10. Error Handling

### Standard Error Format

```json
{
  "error_code": "string",
  "message": "string",
  "request_id": "uuid"
}
```

---

## 11. Health & System APIs

### GET /api/v1/health

**Purpose:**
System health check.

**Response:**

```json
{
  "status": "UP"
}
```

---

## 12. Versioning Strategy

* Breaking changes → new API version
* Backward compatibility within same version